<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>统一文件管理器 - 本地和远程文件管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="bg-light">
<!-- 顶部导航栏 -->
<nav class="top-navbar">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div class="navbar-brand">
                <i class="bi bi-files"></i> 统一文件管理器
            </div>
            <div class="d-flex align-items-center">
                <!-- 模式切换按钮 -->
                <div class="mode-toggle">
                    <button type="button" id="localModeBtn" class="btn">
                        <i class="bi bi-laptop"></i> 本地模式
                    </button>
                    <button type="button" id="remoteModeBtn" class="btn">
                        <i class="bi bi-cloud"></i> 远程模式
                    </button>
                </div>
                <!-- 连接状态指示器 -->
                <div class="connection-status">
                        <span id="connectionBadge" class="badge bg-danger">
                            <i class="bi bi-wifi-off"></i> 未连接
                        </span>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- 功能菜单 -->
<div class="function-menu">
    <div class="function-tabs">
        <button class="function-tab active" data-function="connection">
            <i class="bi bi-plug"></i> 连接管理
        </button>
        <button class="function-tab" data-function="tools">
            <i class="bi bi-tools"></i> 本地工具
        </button>
        <button class="function-tab" data-function="compare">
            <i class="bi bi-search"></i> 目录比较
        </button>
        <button class="function-tab" data-function="tree">
            <i class="bi bi-tree-fill"></i> 目录树
        </button>
        <button class="function-tab" data-function="clean">
            <i class="bi bi-trash"></i> 空目录清理
        </button>
        <button class="function-tab" data-function="rename">
            <i class="bi bi-pencil-square"></i> 批量重命名
        </button>
        <button class="function-tab" data-function="organize">
            <i class="bi bi-folder-plus"></i> 目录整理
        </button>
        <button class="function-tab" data-function="editor">
            <i class="bi bi-code-slash"></i> 文件编辑器
        </button>
    </div>
</div>

<!-- 消息提示容器 -->
<div class="message-container" id="messageContainer"></div>

<!-- 自定义确认对话框 -->
<div class="modal fade custom-confirm-modal" id="customConfirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalTitle">
                    <i class="bi bi-exclamation-triangle"></i> 确认操作
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="confirmModalIcon"></div>
                <div id="confirmModalMessage"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel text-white" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> 取消
                </button>
                <button type="button" class="btn btn-confirm text-white" id="confirmModalOkBtn">
                    <i class="bi bi-check-circle"></i> 确认
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 操作日志面板 -->
<div class="operation-log" id="operationLog">
    <div class="log-header">
        <div>
            <i class="bi bi-clock-history"></i> 操作日志
        </div>
        <div>
            <button class="btn btn-sm text-white" onclick="toggleOperationLog()"
                    style="background: none; border: none;">
                <i class="bi bi-dash-square"></i>
            </button>
        </div>
    </div>
    <div class="log-content" id="logContent"></div>
    <div class="log-actions">
        <button class="undo-btn" onclick="undoLastOperation()" id="undoBtn" disabled>
            <i class="bi bi-arrow-counterclockwise"></i> 撤销
        </button>
        <button class="clear-log-btn" onclick="clearOperationLog()">
            <i class="bi bi-trash"></i> 清空
        </button>
        <button class="clear-log-btn" onclick="toggleOperationLog()">
            <i class="bi bi-eye-slash"></i> 隐藏
        </button>
    </div>
</div>

<!-- 浮动操作日志按钮 -->
<div class="floating-log-btn" id="floatingLogBtn" onclick="showOperationLog()">
    <i class="bi bi-clock-history"></i>
    <span class="badge bg-danger" id="logCount" style="display: none;">0</span>
</div>

<div class="container main-container">

    <!-- 连接管理面板 -->
    <div class="function-panel active" id="connectionPanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-plug"></i> SSH 服务器连接
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- 认证方式选择 -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="authType" id="authPassword"
                                           autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" for="authPassword">
                                        <i class="bi bi-shield-lock"></i> 密码认证
                                    </label>
                                    <input type="radio" class="btn-check" name="authType" id="authKey"
                                           autocomplete="off">
                                    <label class="btn btn-outline-primary" for="authKey">
                                        <i class="bi bi-key"></i> SSH密钥认证
                                    </label>
                                </div>
                            </div>
                        </div>

                        <form id="connectionForm">
                            <!-- 基本连接信息 -->
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="hostname" class="form-label">服务器地址</label>
                                        <input type="text" class="form-control" id="hostname"
                                               placeholder="192.168.1.100" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="username" class="form-label">用户名</label>
                                        <input type="text" class="form-control" id="username" placeholder="root"
                                               required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="port" class="form-label">端口</label>
                                        <input type="number" class="form-control" id="port" value="22">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="connectionDescription" class="form-label">描述（可选）</label>
                                        <input type="text" class="form-control" id="connectionDescription"
                                               placeholder="生产服务器">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label class="form-label">&nbsp;</label>
                                        <div>
                                            <button type="button" id="connectBtn" class="btn btn-primary w-100">
                                                <i class="bi bi-plug"></i> 连接
                                            </button>
                                            <button type="button" id="disconnectBtn" class="btn btn-danger w-100"
                                                    style="display:none;">
                                                <i class="bi bi-plug-fill"></i> 断开
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 密码认证 -->
                            <div id="passwordAuth" class="auth-section">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="password" class="form-label">密码</label>
                                            <input type="password" class="form-control" id="password">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SSH密钥认证 -->
                            <div id="keyAuth" class="auth-section" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="privateKeyPath" class="form-label">私钥文件路径</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="privateKeyPath"
                                                       placeholder="C:\Users\用户\.ssh\id_rsa">
                                                <button class="btn btn-outline-secondary" type="button"
                                                        onclick="browsePrivateKey()">
                                                    <i class="bi bi-folder"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="keyPassphrase" class="form-label">密钥密码（可选）</label>
                                            <input type="password" class="form-control" id="keyPassphrase"
                                                   placeholder="私钥保护密码">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- 连接历史面板 -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history"></i> 连接历史
                        </h5>
                        <button class="btn btn-sm btn-outline-light" onclick="refreshConnectionHistory()">
                            <i class="bi bi-arrow-clockwise"></i> 刷新
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="connectionHistoryList">
                            <div class="text-center py-3">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">加载中...</span>
                                </div>
                                <p class="mt-2 text-muted">正在加载连接历史...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 本地工具面板 -->
    <div class="function-panel" id="toolsPanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-tools"></i> 本地工具集
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info" role="alert">
                            <i class="bi bi-info-circle"></i>
                            本地工具集仅在本地模式下可用，可以对本地文件系统进行操作。
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="bi bi-tree"></i> 目录树生成</h6>
                                <p class="text-muted small">生成指定目录的树形结构图</p>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="bi bi-trash"></i> 空目录清理</h6>
                                <p class="text-muted small">清理指定目录下的所有空目录</p>
                            </div>
                        </div>
                        <p class="text-muted">请通过左侧菜单访问具体工具功能。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 目录比较面板 -->
    <div class="function-panel" id="comparePanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-search"></i> 目录比较
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="path1" class="form-label">路径 1</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="path1"
                                               placeholder="/home/user/folder1">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('path1')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="path2" class="form-label">路径 2</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="path2"
                                               placeholder="/home/user/folder2">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('path2')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="similarityThreshold" class="form-label">相似度阈值</label>
                                    <select class="form-control" id="similarityThreshold">
                                        <option value="0.6">60%</option>
                                        <option value="0.7">70%</option>
                                        <option value="0.8" selected>80%</option>
                                        <option value="0.9">90%</option>
                                        <option value="1.0">完全匹配</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <div>
                                        <button type="button" id="compareBtn" class="btn btn-success w-100">
                                            <i class="bi bi-search"></i> 比较
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 目录树面板 -->
    <div class="function-panel" id="treePanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-tree"></i> 目录树生成
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="treeDirectory" class="form-label">目录路径</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="treeDirectory"
                                               placeholder="当前目录">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('treeDirectory')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="maxLevel" class="form-label">最大层级</label>
                                    <input type="number" class="form-control" id="maxLevel" placeholder="不限制">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">选项</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="applyGitignore" checked>
                                            <label class="form-check-label" for="applyGitignore">
                                                应用 .gitignore
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="excludeFiles">
                                            <label class="form-check-label" for="excludeFiles">
                                                仅显示目录
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <div>
                                        <button type="button" id="generateTreeBtn" class="btn btn-success w-100">
                                            <i class="bi bi-tree"></i> 生成目录树
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 目录树输出 -->
        <div class="row mb-4" id="treeOutputPanel" style="display:none;">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-tree-fill"></i> 目录树结构
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="treeOutput" class="tree-output"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 空目录清理面板 -->
    <div class="function-panel" id="cleanPanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-trash"></i> 空目录清理
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="cleanDirectory" class="form-label">清理目录</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="cleanDirectory"
                                               placeholder="当前目录">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('cleanDirectory')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <div>
                                        <button type="button" id="cleanEmptyDirsBtn" class="btn btn-warning w-100">
                                            <i class="bi bi-trash"></i> 清理空目录
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-warning" role="alert">
                            <i class="bi bi-exclamation-triangle"></i>
                            此操作将永久删除空目录，请谨慎操作！该功能在本地模式和远程模式下均可使用。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 批量重命名面板 -->
    <div class="function-panel" id="renamePanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-pencil-square"></i> 批量重命名
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="renamePath" class="form-label">目标目录</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="renamePath"
                                               placeholder="选择要重命名文件的目录">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('renamePath')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="renameType" class="form-label">重命名类型</label>
                                    <select class="form-select" id="renameType" onchange="toggleRenameInputs()">
                                        <option value="remove_number_prefix">移除数字前缀</option>
                                        <option value="add_sequence_prefix">添加序号前缀</option>
                                        <option value="add_sequence_suffix">添加序号后缀</option>
                                        <option value="add_custom_prefix">添加自定义前缀</option>
                                        <option value="add_custom_suffix">添加自定义后缀</option>
                                        <option value="remove_special_chars">移除特殊字符</option>
                                        <option value="to_lowercase">转为小写</option>
                                        <option value="to_uppercase">转为大写</option>
                                        <option value="space_to_underscore">空格替换下划线</option>
                                        <option value="underscore_to_space">下划线替换空格</option>
                                        <option value="date_prefix">添加日期前缀</option>
                                        <option value="capitalize_words">首字母大写</option>
                                        <option value="regex">正则表达式</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 自定义文本输入框 -->
                        <div class="row" id="customTextInputs" style="display:none;">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="customText" class="form-label">自定义文本</label>
                                    <input type="text" class="form-control" id="customText"
                                           placeholder="输入要添加的文本">
                                    <div class="form-text">将添加到文件名的前缀或后缀位置</div>
                                </div>
                            </div>
                        </div>

                        <!-- 正则表达式输入框 -->
                        <div class="row" id="regexInputs" style="display:none;">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="regexPattern" class="form-label">正则表达式模式</label>
                                    <input type="text" class="form-control" id="regexPattern"
                                           placeholder="例如: ^\d+\s*">
                                    <div class="form-text">匹配要替换的部分</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="regexReplacement" class="form-label">替换内容</label>
                                    <input type="text" class="form-control" id="regexReplacement"
                                           placeholder="留空表示删除">
                                    <div class="form-text">用来替换匹配内容的文本</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <button type="button" class="btn btn-warning" onclick="executeRename()">
                                    <i class="bi bi-pencil-square"></i> 执行重命名
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 目录整理面板 -->
    <div class="function-panel" id="organizePanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-folder-plus"></i> 目录整理
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="organizePath" class="form-label">目标目录</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="organizePath"
                                               placeholder="选择要整理的目录">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browsePath('organizePath')">
                                            <i class="bi bi-folder"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="organizeType" class="form-label">整理类型</label>
                                    <select class="form-select" id="organizeType">
                                        <option value="create_folders_for_files">为文件创建同名文件夹</option>
                                        <option value="remove_empty_dirs">移除空目录</option>
                                    </select>
                                    <div class="form-text">选择目录整理方式</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-info" role="alert">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>整理说明：</strong>
                                    <ul class="mb-0 mt-2">
                                        <li><strong>为文件创建同名文件夹：</strong>为每个文件创建一个以文件名（不含扩展名）命名的文件夹，并将文件移入其中
                                        </li>
                                        <li><strong>移除空目录：</strong>递归删除目录下所有的空文件夹</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <button type="button" class="btn btn-primary" onclick="executeOrganize()">
                                    <i class="bi bi-folder-plus"></i> 执行整理
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 文件编辑器面板 -->
    <div class="function-panel" id="editorPanel">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-code-slash"></i> 文件编辑器
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="editorFilePath" class="form-label">文件路径</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control path-input" id="editorFilePath"
                                               placeholder="输入文件路径或使用浏览器选择">
                                        <button class="btn btn-outline-secondary" type="button"
                                                onclick="browseForFile()">
                                            <i class="bi bi-file-earmark"></i> 浏览
                                        </button>
                                        <button class="btn btn-outline-primary" type="button"
                                                onclick="loadFileContent()">
                                            <i class="bi bi-folder-open"></i> 打开
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="fileType" class="form-label">文件类型</label>
                                    <select class="form-select" id="fileType" onchange="updateEditorLanguage()">
                                        <option value="text">纯文本</option>
                                        <option value="yaml">YAML</option>
                                        <option value="json">JSON</option>
                                        <option value="xml">XML</option>
                                        <option value="ini">INI/Config</option>
                                        <option value="shell">Shell Script</option>
                                        <option value="python">Python</option>
                                        <option value="javascript">JavaScript</option>
                                        <option value="css">CSS</option>
                                        <option value="html">HTML</option>
                                        <option value="sql">SQL</option>
                                        <option value="markdown">Markdown</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="editor-container">
                                    <div class="editor-toolbar">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <span class="badge bg-secondary" id="fileInfo">未加载文件</span>
                                                <span class="badge bg-info" id="cursorInfo">行: 1, 列: 1</span>
                                            </div>
                                            <div>
                                                <button class="btn btn-sm btn-outline-secondary"
                                                        onclick="formatContent()">
                                                    <i class="bi bi-code"></i> 格式化
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="saveFileContent()">
                                                    <i class="bi bi-save"></i> 保存
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <textarea id="fileEditor" class="file-editor"
                                              placeholder="在这里编辑文件内容..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 结果显示面板 -->
    <div class="row" id="resultsPanel" style="display:none;">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" id="resultsTitle">
                        <i class="bi bi-files"></i> 重复文件列表
                    </h5>
                    <span id="duplicateCount" class="badge bg-light text-dark"></span>
                </div>
                <div class="card-body">
                    <!-- 批量操作控制区 -->
                    <div class="batch-controls" id="batchControls" style="display:none;">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="selectAll">
                                    <label class="form-check-label" for="selectAll">
                                        <strong>全选/全不选</strong>
                                    </label>
                                </div>
                                <small class="text-muted">已选择: <span id="selectedCount">0</span> 个项目</small>
                            </div>
                            <div class="col-md-6 text-end">
                                <button type="button" class="btn btn-warning me-2" onclick="batchDeletePath1()">
                                    <i class="bi bi-trash"></i> 批量删除路径1
                                </button>
                                <button type="button" class="btn btn-danger" onclick="batchDeletePath2()">
                                    <i class="bi bi-trash"></i> 批量删除路径2
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="duplicatesList"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 目录浏览模态框 -->
<div class="modal fade" id="browseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-folder-open"></i> 选择目录
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- 路径输入框 -->
                <div class="path-input-container">
                    <input type="text" class="form-control" id="directPathInput" placeholder="输入目录路径并按回车键跳转...">
                    <button type="button" class="btn btn-primary" onclick="navigateToPath()">
                        <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
                
                <!-- 面包屑导航 -->
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb" id="pathBreadcrumb"></ol>
                </nav>
                
                <!-- 文件列表 -->
                <div id="fileList" class="list-group"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="selectPathBtn">选择此路径</button>
            </div>
        </div>
    </div>
</div>

<!-- 加载提示 -->
<div class="position-fixed top-50 start-50 translate-middle loading" id="loadingSpinner">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">加载中...</span>
    </div>
</div>

<!-- JavaScript 文件引用 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script src="{{ url_for('static', filename='js/connection.js') }}"></script>
<script src="{{ url_for('static', filename='js/file-browser.js') }}"></script>
<script src="{{ url_for('static', filename='js/tools.js') }}"></script>
<script src="{{ url_for('static', filename='js/logs.js') }}"></script>
<script src="{{ url_for('static', filename='js/file-editor.js') }}"></script>
<script src="{{ url_for('static', filename='js/batch-operations.js') }}"></script>
</body>
</html> 