# 脚本集合

> [!前言]
> 这个脚本集合包含了一些实用的文件夹管理工具，主要用于目录结构展示、空文件夹清理和远程文件管理。

## 脚本列表

### 1. tree.sh - 目录树生成脚本
用于生成项目目录结构树，支持多种自定义选项，便于文档编写和项目结构展示。

### 2. interactive_delete_empty_dirs.sh - 交互式空文件夹删除脚本
提供一个交互式界面来浏览目录并删除空文件夹，支持目录导航和批量清理。

### 3. ssh_file_manager.py - SSH远程文件管理器 🆕
带有现代化Web界面的Python应用，用于连接远程SSH服务器，检测和删除重复文件。支持可视化操作界面和安全的文件管理功能。

**最新更新 (v1.1)**:
- 🐛 修复了目录浏览器中面包屑导航的连接检查问题
- 🔧 改进了连接状态检测的可靠性
- ✨ 增强了错误处理和用户反馈机制

## 详细使用说明

## ssh_file_manager.py 使用方法

### 功能描述
这是一个基于Web的SSH文件管理工具，主要功能包括：
- 通过Web界面连接远程SSH服务器
- 可视化浏览远程服务器目录结构  
- 比较两个不同路径下的文件和文件夹
- 智能检测重复文件（基于文件名、大小和MD5哈希）
- **🆕 模糊名称匹配**: 检测名称相似的文件和文件夹
- **🆕 多选功能**: 支持批量选择文件进行操作
- **🆕 批量删除**: 一键删除多个选中的文件或目录
- 安全删除重复的文件或目录
- 现代化的响应式Web界面

### 安装和启动

#### 方法一：使用启动脚本（推荐）

**Windows 用户:**
```bash
# 双击运行或在命令行中执行
run_ssh_manager.bat
```

**Linux/macOS 用户:**
```bash
# 添加执行权限
chmod +x run_ssh_manager.sh
# 运行脚本
./run_ssh_manager.sh
```

#### 方法二：手动安装

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **启动应用**
   ```bash
   python ssh_file_manager.py
   ```

3. **访问Web界面**
   在浏览器中打开：`http://localhost:5000`

### 使用步骤

#### 第一步：连接SSH服务器
1. 在Web界面的"SSH服务器连接"面板中输入：
   - 服务器地址（如：192.168.1.100）
   - 用户名（如：root）
   - 密码
   - 端口（默认：22）
2. 点击"连接"按钮
3. 连接成功后，状态指示器会变为绿色"已连接"

#### 第二步：设置比较路径
1. 在"目录比较"面板中输入两个要比较的路径
2. 可以点击文件夹图标浏览和选择目录
3. 设置相似度阈值（60%-100%）：
   - **60%-80%**: 检测出更多相似文件，可能包含误报
   - **80%**: 默认推荐值，平衡准确性和召回率
   - **90%-100%**: 更严格的匹配，减少误报
4. 示例路径：
   - 路径1：`/home/user/backup`
   - 路径2：`/home/user/current`

#### 第三步：执行比较
1. 点击"比较"按钮开始扫描
2. 系统会：
   - 列出两个目录下的所有文件和文件夹
   - 比较文件名、大小和内容（MD5哈希）
   - 识别完全重复的项目（红色边框）
   - 识别名称相似的项目（黄色边框）

#### 第四步：管理重复文件

##### 单个删除
1. 查看"重复文件列表"中的结果
2. 每个重复项显示：
   - 文件/文件夹名称和类型
   - 相似度百分比（对于相似项）
   - 两个路径的完整位置
   - 文件大小和修改时间
   - 单独删除按钮
3. 选择要删除的版本，点击对应的"删除"按钮
4. 确认删除操作（不可撤销）

##### 批量删除
1. 使用复选框选择多个项目：
   - 点击左侧复选框选择单个项目
   - 使用"全选/全不选"批量选择
2. 选择批量删除选项：
   - **批量删除路径1**: 删除选中项目在第一个路径中的版本
   - **批量删除路径2**: 删除选中项目在第二个路径中的版本
3. 确认批量删除操作
4. 查看删除结果摘要

### 安全特性
- **确认删除**: 所有删除操作都需要用户确认
- **MD5验证**: 文件内容比较使用MD5哈希确保准确性
- **递归删除**: 安全删除目录及其所有子内容
- **连接超时**: SSH连接包含超时保护
- **错误处理**: 完善的错误提示和异常处理

### 界面特性
- **响应式设计**: 适配桌面和移动设备
- **现代化UI**: 使用Bootstrap 5和图标
- **实时状态**: 连接状态实时显示
- **目录浏览**: 可视化文件系统浏览器
- **加载指示**: 操作过程中的加载提示
- **🆕 颜色区分**: 完全重复项(红色)和相似项(黄色)用不同颜色标识
- **🆕 批量操作**: 直观的多选界面和批量控制面板
- **🆕 相似度显示**: 实时显示文件名相似度百分比

## tree.sh 使用方法

### 功能描述
生成项目目录结构树，支持：
- 应用 .gitignore 过滤规则
- 自定义输出层级
- 选择是否包含文件
- 导出结果到文本文件

### 使用步骤

#### 第一步：运行脚本
```bash
./tree.sh
```
或双击运行

#### 第二步：交互式配置

##### 1. 是否应用 .gitignore 中的内容?
- 输入 `y`: 会忽略 .gitignore 中指定的文件和目录（如 target、logs、.vscode 等）
- 输入 `n`: 显示所有文件和目录

##### 2. 输出的树是否不包含文件?
- 输入 `y`: 只显示目录结构，不显示文件
- 输入 `n`: 显示完整的目录和文件结构

##### 3. 请输入输出的层级 (默认输出所有层级):
- 直接回车: 输出所有层级
- 输入数字: 只输出指定层级深度（如输入 `3` 则只显示3级目录）

##### 4. 是否导出这个输出的树?
- 输入 `y`: 将结果导出到 `directory_tree.txt` 文件
- 输入 `n`: 只在终端显示结果

## interactive_delete_empty_dirs.sh 使用方法

### 功能描述
提供交互式界面来浏览目录并删除空文件夹，特别适用于清理项目中的空目录。

### 使用步骤

#### 第一步：运行脚本
```bash
./interactive_delete_empty_dirs.sh
```

#### 第二步：交互式操作

脚本会显示当前目录下的所有子目录，并提供以下选项：

##### 目录导航
- **数字选项 (1, 2, 3...)**: 进入对应编号的子目录
- **b**: 返回上一层目录
- **q**: 退出脚本

##### 批量操作
- **a**: 检测并删除当前目录下所有空文件夹

### 操作示例
```
当前位置: /home/user/project
-------------------------
1) src
2) docs
3) tests
a) 检测并删除当前目录下所有空文件夹
b) 返回上一层
q) 退出脚本
-------------------------
请输入要进入的目录编号，或选择操作:
```

### 安全提示
- 删除操作是不可逆的，请谨慎使用
- 建议在重要项目中先备份再进行清理操作
- 脚本只会删除完全为空的文件夹

## 示例效果

### tree.sh 输出示例

#### 只含有三级目录
![](https://nas.allbs.cn:9006/cloudpic/2024/06/0747c8da143ff01f80da254578b46db4.png)

#### 包含文件的四级文件树
![](https://nas.allbs.cn:9006/cloudpic/2024/06/790860951e8f44124360cc9fe572c4e2.png)

#### 指定忽略部分文件或者文件夹（如target目录、logs目录）
![image.png](https://nas.allbs.cn:9006/cloudpic/2024/06/1395e2d07c09d65961754d4a0ab422cb.png)

### SSH文件管理器界面示例

SSH文件管理器提供了现代化的Web界面，包括：
- 服务器连接面板
- 目录比较工具
- 重复文件可视化列表
- 安全的删除确认

## 注意事项

### 通用要求

1. **权限要求**: 确保脚本具有执行权限
   ```bash
   chmod +x tree.sh
   chmod +x interactive_delete_empty_dirs.sh
   chmod +x run_ssh_manager.sh  # Linux/macOS
   ```

2. **系统兼容性**: 
   - Shell脚本适用于 Linux 和 macOS 系统
   - Python脚本支持 Windows、Linux 和 macOS
   - Windows 用户可以在 WSL、Git Bash 或 PowerShell 中运行

### SSH文件管理器特殊要求

3. **Python环境**: 需要 Python 3.7 或更高版本
   ```bash
   python --version  # 检查Python版本
   ```

4. **网络要求**: 确保能够访问目标SSH服务器
   - 检查网络连通性
   - 确认SSH服务正在运行（通常是22端口）
   - 确保有正确的用户名和密码

5. **依赖工具**: 
   - tree.sh 需要系统安装 `tree` 命令：
     - Ubuntu/Debian: `sudo apt-get install tree`
     - CentOS/RHEL: `sudo yum install tree`
     - macOS: `brew install tree`
   - SSH文件管理器的依赖会自动安装

### 安全建议

6. **SSH安全**: 
   - 使用强密码或密钥认证
   - 避免在不安全的网络中使用
   - 定期更新服务器和客户端

7. **数据安全**: 
   - 删除操作前建议备份重要数据
   - 在测试环境中先验证脚本功能
   - 谨慎处理系统关键目录
